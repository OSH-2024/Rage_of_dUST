# Ceph部署文档

lab4 report 部署部分


### 单机部署
#### 系统环境
VMWare Workstation 16 Pro虚拟机。虚拟机系统为Ubuntu 22.04.4，硬件配置如下：
- 4GB内存；
- 2个单核处理器；
- 四个SCSI硬盘，其中主硬盘30G用于安装Ubuntu系统本身和必要软件；三个8G新硬盘用于Ceph OSD；
- IP：192.168.222.135

#### 准备工作

- 首先`sudo vim /etc/hosts`将主机的IP加入到HOSTS文件中。
- 必要软件：`openssh-server docker net-tools`，均可以使用apt。

#### 部署方法
**我们使用Ceph官方推荐的cephadm工具完成部署。**

- 使用apt安装cephadm。
- 使用`cephadm bootstrap --mon-ip 192.168.222.135`(192.168.222.135 为主机ip，使用`ifconfig`可以获得)，完成bootstrap之后，cephadm会提供`ceph dashboard`的网址（一般为`localhost:8443`）和初始账号密码，然后可以登录dashboard，通过图形化的方式监控集群。
- 由于是单机部署，需要在bootstrap时添加`--single-host-defaults`参数，否则会出现意想不到的错误。
- 之后运行`cephadm add-repo --release reef` `cephadm install ceph-common`，即可正常使用`ceph`命令，对集群进行管理。
- 然后使用`ceph orch apply osd --all-available-devices`告知Ceph计划在所有空闲磁盘上部署OSD。
- 可使用`ceph status`查看集群的状态是否健康，或者使用 `ceph health detail`

### 多机部署
